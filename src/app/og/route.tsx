import { ImageResponse } from "next/og";

export const runtime = "edge";

const font = fetch(new URL("Inter-SemiBold.otf", import.meta.url)).then((res) =>
  res.arrayBuffer()
);

export async function GET(req: Request): Promise<Response> {
  try {
    const { searchParams } = new URL(req.url);

    // ?title=<title>
    const title =
      searchParams.get("title")?.slice(0, 75) || "Pipe0 Documentation";

    return new ImageResponse(
      (
        <div
          tw="text-white px-20 py-[70px] bg-[#030303] h-full w-full flex justify-between flex-col"
          style={{
            backgroundImage:
              "radial-gradient(circle at 25px 25px, #333 2%, transparent 0%), radial-gradient(circle at 75px 75px, #333 2%, transparent 0%)",
            backgroundSize: "100px 100px",
            backgroundPosition: "-30px -10px",
          }}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="170"
            height="64"
            fill="none"
            viewBox="0 0 170 64"
          >
            <path
              fill="#fff"
              d="M104.121 46.14q-4.105 0-7.242-1.825-3.135-1.882-4.904-5.19-1.767-3.306-1.767-7.697 0-4.448 1.71-7.812 1.769-3.365 4.904-5.246 3.194-1.882 7.356-1.882 4.106 0 7.071 1.882a12.3 12.3 0 0 1 4.562 4.904q1.653 3.078 1.653 6.785v1.255q0 .627-.057 1.425H96.138q.285 3.935 2.566 5.988 2.281 1.995 5.36 1.995 2.68 0 4.22-1.083 1.597-1.14 2.338-3.08h6.101q-1.026 4.05-4.277 6.843-3.249 2.737-8.325 2.737m0-24.406q-2.794 0-4.96 1.71-2.168 1.655-2.795 4.676h15.054q-.228-2.85-2.224-4.618-1.995-1.768-5.075-1.768M60.978 58V17.172h5.246l.456 4.334h.342q1.14-2.11 3.421-3.535 2.339-1.483 5.532-1.483 3.307 0 6.044 1.71 2.738 1.654 4.334 4.962 1.653 3.249 1.653 8.154 0 4.847-1.71 8.154-1.655 3.307-4.505 5.018-2.852 1.654-6.387 1.654-3.136 0-5.246-1.255t-3.136-2.851V58zm13.4-17.62q3.193 0 5.303-2.28 2.167-2.282 2.167-6.843 0-4.562-2.167-6.786-2.11-2.224-5.303-2.224-3.25 0-5.417 2.281-2.11 2.225-2.11 6.786 0 4.505 2.11 6.785 2.166 2.28 5.417 2.281M45.09 12.838q-1.995 0-3.364-1.254-1.311-1.312-1.311-3.193t1.311-3.137Q43.095 4 45.091 4q2.053 0 3.364 1.254 1.368 1.255 1.369 3.137t-1.369 3.193q-1.312 1.254-3.364 1.254M33.744 45.455V40.21h8.896V24.3q0-1.88-1.825-1.88h-6.272v-5.247h7.355q3.535 0 5.133 1.654 1.653 1.596 1.653 5.132v16.251h8.896v5.246zM4 58V17.172h5.246l.456 4.334h.342q1.14-2.11 3.422-3.535 2.338-1.483 5.53-1.483 3.308 0 6.045 1.71 2.738 1.654 4.334 4.962 1.654 3.249 1.654 8.154 0 4.847-1.711 8.154-1.654 3.307-4.505 5.018-2.851 1.654-6.386 1.654-3.137 0-5.246-1.255t-3.137-2.851V58zm13.4-17.62q3.194 0 5.303-2.28 2.167-2.282 2.167-6.843 0-4.562-2.167-6.786-2.11-2.224-5.303-2.224-3.25 0-5.417 2.281-2.11 2.225-2.11 6.786 0 4.505 2.11 6.785 2.167 2.28 5.417 2.281"
            ></path>
            <path
              fill="#fff"
              fillRule="evenodd"
              d="m129.243 51.425-.023-.016a16.2 16.2 0 0 1-5.338-5.84l-.021-.038-.019-.04a16.9 16.9 0 0 1-1.842-7.74c0-1.204.105-2.355.359-3.416 1.183-4.953 3.213-9.476 6.096-13.54 2.951-4.162 6.815-7.456 11.532-9.879l.006-.003c1.41-.72 3.006-1.364 4.767-1.943 1.897-.623 3.768-.97 5.592-.97 2.478 0 4.856.53 7.101 1.578a19.9 19.9 0 0 1 5.911 4.144 19.1 19.1 0 0 1 4.054 5.832c1.047 2.236 1.582 4.585 1.582 7.02q0 1.17-.169 2.332l-.002.017-.003.017a18 18 0 0 1-.47 2.115c-.344 1.48-.9 2.911-1.652 4.288a23.5 23.5 0 0 1-2.408 3.603c-1.904 2.508-4.207 4.814-6.886 6.926l-.014.01-.014.011a43.2 43.2 0 0 1-8.783 5.236l-.011.005-.01.005c-3.178 1.391-6.457 2.246-9.827 2.548l-3.493.313v-.428c-2.159-.27-4.173-.968-5.992-2.132zm1.701-28.63q-3.856 5.514-5.467 12.263-.03.126-.057.255l-.003.016q-.137.676-.186 1.483a16 16 0 0 0-.018 1.478 13.7 13.7 0 0 0 1.494 5.79 13.2 13.2 0 0 0 1.965 2.738l.018.019a13.2 13.2 0 0 0 2.322 1.956q2.197 1.408 4.969 1.684a14 14 0 0 0 1.387.067h.546a2.3 2.3 0 0 0 .547-.067v.067l.017-.002q.322-.028.645-.065 1.279-.147 2.541-.412 1.485-.313 2.947-.791l.037-.012q1.324-.435 2.629-1.007a40 40 0 0 0 4.775-2.526l.028-.017a40 40 0 0 0 3.329-2.305 38 38 0 0 0 3.371-2.983l.021-.02a33 33 0 0 0 2.964-3.393 20.3 20.3 0 0 0 2.085-3.105l.022-.04.011-.02a13.7 13.7 0 0 0 1.367-3.568q.273-.943.41-1.818a13 13 0 0 0 .132-2.222 13.3 13.3 0 0 0-1.294-5.386 16 16 0 0 0-1.074-2.013 16.2 16.2 0 0 0-2.343-2.902 16.8 16.8 0 0 0-3.063-2.466l-.052-.032a17 17 0 0 0-1.873-1.004 13.4 13.4 0 0 0-5.741-1.279q-2.119 0-4.579.808-.041.014-.082.027l-.039.013q-2.313.768-4.075 1.656l-.038.018-.071.037q-6.424 3.3-10.387 8.887zm2.05 1.356q-3.555 5.153-5.069 11.475l-.056.24a11 11 0 0 0-.274 2.424q0 2.67.997 4.797l.025.052q.607 1.276 1.575 2.355a8.7 8.7 0 0 0 1.977 1.61q2.17 1.285 5.13 1.285h.069a16 16 0 0 0 .892-.029 19 19 0 0 0 3.404-.53q1.077-.263 2.196-.652 1.232-.453 2.455-1.014l.015-.007a38 38 0 0 0 4.432-2.413 38 38 0 0 0 3.1-2.242l.022-.017a37 37 0 0 0 3.097-2.791 28 28 0 0 0 2.755-3.301 23.4 23.4 0 0 0 1.687-2.759l.039-.072a14.7 14.7 0 0 0 1.215-3.008q.202-.734.314-1.47l.004-.028a12 12 0 0 0 .136-1.818 11.5 11.5 0 0 0-.879-4.415 13 13 0 0 0-.897-1.78 14 14 0 0 0-1.891-2.561 13.7 13.7 0 0 0-2.688-2.219 11.5 11.5 0 0 0-1.591-.898l-.019-.009a10.74 10.74 0 0 0-4.814-.974q-1.774.053-3.834.782l-.061.022q-2.187.74-3.827 1.549l-.073.037-.005.003q-5.871 3.045-9.45 8.219zm-2 12.41q-.098.437-.147.866a8 8 0 0 0-.048.863c0 2.19.635 3.816 1.78 5.099 1.091 1.178 2.552 1.844 4.72 1.844 1.616 0 3.431-.317 5.469-1.023 2.077-.764 4.16-1.797 6.248-3.113a34.3 34.3 0 0 0 5.66-4.595c1.674-1.732 2.96-3.501 3.894-5.303l.012-.024.013-.023c.92-1.704 1.333-3.33 1.333-4.914 0-1.553-.419-3.067-1.331-4.589l-.014-.023-.014-.023a10.46 10.46 0 0 0-3.525-3.685l-.038-.024-.037-.024c-1.343-.904-2.765-1.336-4.344-1.336-.821 0-1.835.174-3.074.618l-.026.01-.027.009c-1.344.455-2.476.915-3.41 1.374-3.545 1.83-6.335 4.282-8.434 7.364l-.005.008-.005.007c-2.18 3.16-3.733 6.696-4.65 10.636"
              clipRule="evenodd"
            ></path>
            <path
              fill="#fff"
              fillRule="evenodd"
              d="m129.243 51.425-.023-.016a16.2 16.2 0 0 1-5.338-5.84l-.021-.038-.019-.04a16.9 16.9 0 0 1-1.842-7.74c0-1.204.105-2.355.359-3.416 1.183-4.953 3.213-9.476 6.096-13.54 2.951-4.162 6.815-7.456 11.532-9.879l.006-.003c1.41-.72 3.006-1.364 4.767-1.943 1.897-.623 3.768-.97 5.592-.97 2.478 0 4.856.53 7.101 1.578a19.9 19.9 0 0 1 5.911 4.144 19.1 19.1 0 0 1 4.054 5.832c1.047 2.236 1.582 4.585 1.582 7.02q0 1.17-.169 2.332l-.002.017-.003.017a18 18 0 0 1-.47 2.115c-.344 1.48-.9 2.911-1.652 4.288a23.5 23.5 0 0 1-2.408 3.603c-1.904 2.508-4.207 4.814-6.886 6.926l-.014.01-.014.011a43.2 43.2 0 0 1-8.783 5.236l-.011.005-.01.005c-3.178 1.391-6.457 2.246-9.827 2.548l-3.493.313v-.428c-2.159-.27-4.173-.968-5.992-2.132zm1.701-28.63q-3.856 5.514-5.467 12.263-.03.126-.057.255l-.003.016q-.137.676-.186 1.483a16 16 0 0 0-.018 1.478 13.7 13.7 0 0 0 1.494 5.79 13.2 13.2 0 0 0 1.965 2.738l.018.019a13.2 13.2 0 0 0 2.322 1.956q2.197 1.408 4.969 1.684a14 14 0 0 0 1.387.067h.546a2.3 2.3 0 0 0 .547-.067v.067l.017-.002q.322-.028.645-.065 1.279-.147 2.541-.412 1.485-.313 2.947-.791l.037-.012q1.324-.435 2.629-1.007a40 40 0 0 0 4.775-2.526l.028-.017a40 40 0 0 0 3.329-2.305 38 38 0 0 0 3.371-2.983l.021-.02a33 33 0 0 0 2.964-3.393 20.3 20.3 0 0 0 2.085-3.105l.022-.04.011-.02a13.7 13.7 0 0 0 1.367-3.568q.273-.943.41-1.818a13 13 0 0 0 .132-2.222 13.3 13.3 0 0 0-1.294-5.386 16 16 0 0 0-1.074-2.013 16.2 16.2 0 0 0-2.343-2.902 16.8 16.8 0 0 0-3.063-2.466l-.052-.032a17 17 0 0 0-1.873-1.004 13.4 13.4 0 0 0-5.741-1.279q-2.119 0-4.579.808-.041.014-.082.027l-.039.013q-2.313.768-4.075 1.656l-.038.018-.071.037q-6.424 3.3-10.387 8.887zm2.05 1.356q-3.555 5.153-5.069 11.475l-.056.24a11 11 0 0 0-.274 2.424q0 2.67.997 4.797l.025.052q.607 1.276 1.575 2.355a8.7 8.7 0 0 0 1.977 1.61q2.17 1.285 5.13 1.285h.069a16 16 0 0 0 .892-.029 19 19 0 0 0 3.404-.53q1.077-.263 2.196-.652 1.232-.453 2.455-1.014l.015-.007a38 38 0 0 0 4.432-2.413 38 38 0 0 0 3.1-2.242l.022-.017a37 37 0 0 0 3.097-2.791 28 28 0 0 0 2.755-3.301 23.4 23.4 0 0 0 1.687-2.759l.039-.072a14.7 14.7 0 0 0 1.215-3.008q.202-.734.314-1.47l.004-.028a12 12 0 0 0 .136-1.818 11.5 11.5 0 0 0-.879-4.415 13 13 0 0 0-.897-1.78 14 14 0 0 0-1.891-2.561 13.7 13.7 0 0 0-2.688-2.219 11.5 11.5 0 0 0-1.591-.898l-.019-.009a10.74 10.74 0 0 0-4.814-.974q-1.774.053-3.834.782l-.061.022q-2.187.74-3.827 1.549l-.073.037-.005.003q-5.871 3.045-9.45 8.219zm-2 12.41q-.098.437-.147.866a8 8 0 0 0-.048.863c0 2.19.635 3.816 1.78 5.099 1.091 1.178 2.552 1.844 4.72 1.844 1.616 0 3.431-.317 5.469-1.023 2.077-.764 4.16-1.797 6.248-3.113a34.3 34.3 0 0 0 5.66-4.595c1.674-1.732 2.96-3.501 3.894-5.303l.012-.024.013-.023c.92-1.704 1.333-3.33 1.333-4.914 0-1.553-.419-3.067-1.331-4.589l-.014-.023-.014-.023a10.46 10.46 0 0 0-3.525-3.685l-.038-.024-.037-.024c-1.343-.904-2.765-1.336-4.344-1.336-.821 0-1.835.174-3.074.618l-.026.01-.027.009c-1.344.455-2.476.915-3.41 1.374-3.545 1.83-6.335 4.282-8.434 7.364l-.005.008-.005.007c-2.18 3.16-3.733 6.696-4.65 10.636"
              clipRule="evenodd"
            ></path>
          </svg>
          <h1
            tw="text-transparent text-[82px] m-0 mb-10 tracking-tighter leading-[1.1]"
            style={{
              textShadow: "0 2px 30px #000",
              backgroundImage: "linear-gradient(90deg, #fff 40%, #aaa)",
              backgroundClip: "text",
              // To preserve new line
              whiteSpace: "pre",
            }}
          >
            {title}
          </h1>
          <p tw="m-0 text-3xl tracking-tight">
            Powering data enrichment for the next generation of software
          </p>
        </div>
      ),
      {
        width: 1200,
        height: 630,
        fonts: [
          {
            name: "inter",
            data: await font,
            style: "normal",
          },
        ],
      }
    );
  } catch (error) {
    console.error(error);
    return new Response("Failed to generate the image", { status: 500 });
  }
}
